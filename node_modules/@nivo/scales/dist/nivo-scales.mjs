import n from"lodash/uniq.js";import t from"lodash/uniqBy.js";import r from"lodash/sortBy.js";import e from"lodash/last.js";import i from"lodash/isDate.js";import{utcParse as a,timeParse as o}from"d3-time-format";import{scaleLinear as u,scalePoint as c,scaleBand as d,scaleUtc as s,scaleTime as f,scaleLog as l,scaleSymlog as m}from"d3-scale";import{interpolateRound as v,interpolateNumber as p}from"d3-interpolate";import{timeInterval as y,timeMillisecond as h,utcMillisecond as g,timeSecond as x,utcSecond as k,timeMinute as T,utcMinute as b,timeHour as M,utcHour as w,timeWeek as E,utcWeek as S,timeSunday as j,utcSunday as D,timeMonday as C,utcMonday as U,timeTuesday as O,utcTuesday as H,timeWednesday as R,utcWednesday as V,timeThursday as q,utcThursday as A,timeFriday as B,utcFriday as F,timeSaturday as N,utcSaturday as z,timeMonth as I,utcMonth as P,timeYear as $,utcYear as G}from"d3-time";function J(){return J=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var e in r)({}).hasOwnProperty.call(r,e)&&(n[e]=r[e])}return n},J.apply(null,arguments)}var K=["millisecond","second","minute","hour","day","month","year"],L=[function(n){return n.setMilliseconds(0)},function(n){return n.setSeconds(0)},function(n){return n.setMinutes(0)},function(n){return n.setHours(0)},function(n){return n.setDate(1)},function(n){return n.setMonth(0)}],Q={millisecond:[],second:L.slice(0,1),minute:L.slice(0,2),hour:L.slice(0,3),day:L.slice(0,4),month:L.slice(0,5),year:L.slice(0,6)},W=function(n){return function(t){return Q[n].forEach((function(n){n(t)})),t}},X=function(n){var t=n.format,r=void 0===t?"native":t,e=n.precision,i=void 0===e?"millisecond":e,u=n.useUTC,c=void 0===u||u,d=W(i);return function(n){if(void 0===n)return n;if("native"===r||n instanceof Date)return d(n);var t=c?a(r):o(r);return d(t(n))}},Y=function(n,t,r,e){var i,a,o,c,d=n.min,s=void 0===d?0:d,f=n.max,l=void 0===f?"auto":f,m=n.stacked,y=void 0!==m&&m,h=n.reverse,g=void 0!==h&&h,x=n.clamp,k=void 0!==x&&x,T=n.nice,b=void 0!==T&&T,M=n.round,w=void 0===M||M;"auto"===s?i=!0===y?null!=(a=t.minStacked)?a:0:t.min:i=s;"auto"===l?o=!0===y?null!=(c=t.maxStacked)?c:0:t.max:o=l;var E=u().range("x"===e?[0,r]:[r,0]).interpolate(w?v:p).domain(g?[o,i]:[i,o]).clamp(k);return!0===b?E.nice():"number"==typeof b&&E.nice(b),Z(E,y)},Z=function(n,t){void 0===t&&(t=!1);var r=n;return r.type="linear",r.stacked=t,r},_=function(n,t,r){var e=c().range([0,r]).domain(t.all);return e.type="point",e},nn=function(n){var t=n;return t.type="point",t},tn=function(n,t,r,e){var i=n.round,a=void 0===i||i,o=d().range("x"===e?[0,r]:[r,0]).domain(t.all).round(a);return rn(o)},rn=function(n){var t=n;return t.type="band",t},en=function(n,t,r){var e,i,a=n.format,o=void 0===a?"native":a,u=n.precision,c=void 0===u?"millisecond":u,d=n.min,l=void 0===d?"auto":d,m=n.max,v=void 0===m?"auto":m,p=n.useUTC,y=void 0===p||p,h=n.nice,g=void 0!==h&&h,x=X({format:o,precision:c,useUTC:y});e="auto"===l?x(t.min):"native"!==o?x(l):l,i="auto"===v?x(t.max):"native"!==o?x(v):v;var k=y?s():f();k.range([0,r]),e&&i&&k.domain([e,i]),!0===g?k.nice():"object"!=typeof g&&"number"!=typeof g||k.nice(g);var T=k;return T.type="time",T.useUTC=y,T},an=function(n,t,r,e){var i,a=n.base,o=void 0===a?10:a,u=n.min,c=void 0===u?"auto":u,d=n.max,s=void 0===d?"auto":d;if(t.all.some((function(n){return 0===n})))throw new Error("a log scale domain must not include or cross zero");var f,m,v=!1;if(t.all.filter((function(n){return null!=n})).forEach((function(n){v||(void 0===i?i=Math.sign(n):Math.sign(n)!==i&&(v=!0))})),v)throw new Error("a log scale domain must be strictly-positive or strictly-negative");f="auto"===c?t.min:c,m="auto"===s?t.max:s;var p=l().domain([f,m]).rangeRound("x"===e?[0,r]:[r,0]).base(o).nice();return p.type="log",p},on=function(n,t,r,e){var i,a,o=n.constant,u=void 0===o?1:o,c=n.min,d=void 0===c?"auto":c,s=n.max,f=void 0===s?"auto":s,l=n.round,v=void 0===l||l,p=n.reverse,y=void 0!==p&&p,h=n.nice,g=void 0===h||h;i="auto"===d?t.min:d,a="auto"===f?t.max:f;var x=m().constant(u),k="x"===e?[0,r]:[r,0];!0===v?x.rangeRound(k):x.range(k),!0===y?x.domain([a,i]):x.domain([i,a]),!0===g?x.nice():"number"==typeof g&&x.nice(g);var T=x;return T.type="symlog",T},un=function(n){return"x"===n?"y":"x"},cn=function(n,t){return n===t},dn=function(n,t){return n.getTime()===t.getTime()};function sn(n,t,r,e){switch(n.type){case"linear":return Y(n,t,r,e);case"point":return _(0,t,r);case"band":return tn(n,t,r,e);case"time":return en(n,t,r);case"log":return an(n,t,r,e);case"symlog":return on(n,t,r,e);default:throw new Error("invalid scale spec")}}var fn=function(n,t,r){var e;if("stacked"in r&&r.stacked){var i=n.data["x"===t?"xStacked":"yStacked"];return null==i?null:r(i)}return null!=(e=r(n.data[t]))?e:null},ln=function(n,t,r,e,i){var a=n.map((function(n){return function(n){return J({},n,{data:n.data.map((function(n){return{data:J({},n)}}))})}(n)})),o=mn(a,t,r);"stacked"in t&&!0===t.stacked&&yn(o,a),"stacked"in r&&!0===r.stacked&&hn(o,a);var u=sn(t,o.x,e,"x"),c=sn(r,o.y,i,"y"),d=a.map((function(n){return J({},n,{data:n.data.map((function(n){return J({},n,{position:{x:fn(n,"x",u),y:fn(n,"y",c)}})}))})}));return J({},o,{series:d,xScale:u,yScale:c})},mn=function(n,t,r){return{x:vn(n,"x",t),y:vn(n,"y",r)}},vn=function(i,a,o,u){var c=void 0===u?{}:u,d=c.getValue,s=void 0===d?function(n){return n.data[a]}:d,f=c.setValue,l=void 0===f?function(n,t){n.data[a]=t}:f;if("linear"===o.type)i.forEach((function(n){n.data.forEach((function(n){var t=s(n);t&&l(n,parseFloat(String(t)))}))}));else if("time"===o.type&&"native"!==o.format){var m=X(o);i.forEach((function(n){n.data.forEach((function(n){var t=s(n);t&&l(n,m(t))}))}))}var v=[];switch(i.forEach((function(n){n.data.forEach((function(n){v.push(s(n))}))})),o.type){case"linear":var p=r(n(v).filter((function(n){return null!==n})),(function(n){return n}));return{all:p,min:Math.min.apply(Math,p),max:Math.max.apply(Math,p)};case"time":var y=t(v,(function(n){return n.getTime()})).slice(0).sort((function(n,t){return t.getTime()-n.getTime()})).reverse();return{all:y,min:y[0],max:e(y)};default:var h=n(v);return{all:h,min:h[0],max:e(h)}}},pn=function(n,t,r){var a=un(n),o=[];t[a].all.forEach((function(t){var u=i(t)?dn:cn,c=[];r.forEach((function(r){var i=r.data.find((function(n){return u(n.data[a],t)})),d=null,s=null;if(void 0!==i){if(null!==(d=i.data[n])){var f=e(c);void 0===f?s=d:null!==f&&(s=f+d)}i.data["x"===n?"xStacked":"yStacked"]=s}c.push(s),null!==s&&o.push(s)}))})),t[n].minStacked=Math.min.apply(Math,o),t[n].maxStacked=Math.max.apply(Math,o)},yn=function(n,t){return pn("x",n,t)},hn=function(n,t){return pn("y",n,t)},gn=function(n){var t=n.bandwidth();if(0===t)return n;var r=t/2;return n.round()&&(r=Math.round(r)),function(t){var e;return(null!=(e=n(t))?e:0)+r}},xn={millisecond:[h,g],second:[x,k],minute:[T,b],hour:[M,w],day:[y((function(n){return n.setHours(0,0,0,0)}),(function(n,t){return n.setDate(n.getDate()+t)}),(function(n,t){return(t.getTime()-n.getTime())/864e5}),(function(n){return Math.floor(n.getTime()/864e5)})),y((function(n){return n.setUTCHours(0,0,0,0)}),(function(n,t){return n.setUTCDate(n.getUTCDate()+t)}),(function(n,t){return(t.getTime()-n.getTime())/864e5}),(function(n){return Math.floor(n.getTime()/864e5)}))],week:[E,S],sunday:[j,D],monday:[C,U],tuesday:[O,H],wednesday:[R,V],thursday:[q,A],friday:[B,F],saturday:[N,z],month:[I,P],year:[$,G]},kn=Object.keys(xn),Tn=new RegExp("^every\\s*(\\d+)?\\s*("+kn.join("|")+")s?$","i"),bn=function(n,t){if(Array.isArray(t))return t;if("string"==typeof t&&"useUTC"in n){var r=t.match(Tn);if(r){var e=r[1],i=r[2],a=xn[i][n.useUTC?1:0];if("day"===i){var o,u,c=n.domain(),d=c[0],s=c[1],f=new Date(s);return f.setDate(f.getDate()+1),null!=(o=null==(u=a.every(Number(null!=e?e:1)))?void 0:u.range(d,f))?o:[]}if(void 0===e)return n.ticks(a);var l=a.every(Number(e));if(l)return n.ticks(l)}throw new Error("Invalid tickValues: "+t)}if("ticks"in n){if(void 0===t)return n.ticks();if("number"==typeof(m=t)&&isFinite(m)&&Math.floor(m)===m)return n.ticks(t)}var m;return n.domain()};export{rn as castBandScale,Z as castLinearScale,nn as castPointScale,gn as centerScale,dn as compareDateValues,cn as compareValues,sn as computeScale,ln as computeXYScalesForSeries,tn as createBandScale,X as createDateNormalizer,Y as createLinearScale,an as createLogScale,_ as createPointScale,W as createPrecisionMethod,on as createSymlogScale,en as createTimeScale,vn as generateSeriesAxis,mn as generateSeriesXY,un as getOtherAxis,bn as getScaleTicks,L as precisionCutOffs,Q as precisionCutOffsByType,pn as stackAxis,K as timePrecisions};
//# sourceMappingURL=nivo-scales.mjs.map
